<!DOCTYPE html>
<html>

<head>

<meta charset="UTF-8">
<title>Admin Luma Mate</title>

<link rel="stylesheet" href="style.css">

</head>

<body>

<h1>Admin Luma Mate</h1>

<input id="nombre" placeholder="Nombre">

<input id="precio" placeholder="Precio">

<input id="stock" placeholder="Stock">

<input type="file" id="imagen">

<button onclick="subir()">Publicar</button>

<div id="lista"></div>

<script type="module">

import { db,storage } from "./firebase.js"

import {

collection,
addDoc,
getDocs,
deleteDoc,
doc

} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"

import {

ref,
uploadBytes,
getDownloadURL

} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"


async function subir(){

const nombre=document.getElementById("nombre").value
const precio=document.getElementById("precio").value
const stock=document.getElementById("stock").value

const file=document.getElementById("imagen").files[0]

const storageRef=ref(storage,"productos/"+file.name)

await uploadBytes(storageRef,file)

const url=await getDownloadURL(storageRef)

await addDoc(collection(db,"productos"),{

nombre,
precio,
stock,
imagen:url

})

cargar()

}

async function cargar(){

const cont=document.getElementById("lista")

cont.innerHTML=""

const querySnapshot=await getDocs(collection(db,"productos"))

querySnapshot.forEach(d=>{

const p=d.data()

cont.innerHTML+=`

<div>

${p.nombre} $${p.precio}

<button onclick="borrar('${d.id}')">Eliminar</button>

</div>

`

})

}

window.borrar=async function(id){

await deleteDoc(doc(db,"productos",id))

cargar()

}

window.subir=subir

cargar()

</script>

</body>

</html>
